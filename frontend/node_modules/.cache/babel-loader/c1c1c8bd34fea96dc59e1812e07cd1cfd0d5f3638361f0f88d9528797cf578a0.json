{"ast":null,"code":"import { ref, reactive, computed, onMounted } from 'vue';\nimport { useStore } from 'vuex';\nimport { useRouter } from 'vue-router';\nimport { ElMessage } from 'element-plus';\nimport { Upload } from '@element-plus/icons-vue';\nimport { QuillEditor } from '@vueup/vue-quill';\nimport '@vueup/vue-quill/dist/vue-quill.snow.css';\nexport default {\n  name: 'NoticeWrite',\n  components: {\n    QuillEditor\n  },\n  setup() {\n    const store = useStore();\n    const router = useRouter();\n    const noticeFormRef = ref();\n    const uploadRef = ref();\n    const loading = ref(false);\n    const fileList = ref([]);\n    const uploadedFiles = ref([]);\n    const noticeForm = reactive({\n      title: '',\n      content: '',\n      isNotice: false,\n      attachments: []\n    });\n    const rules = {\n      title: [{\n        required: true,\n        message: '제목을 입력해주세요',\n        trigger: 'blur'\n      }, {\n        min: 2,\n        max: 200,\n        message: '제목은 2-200자 사이여야 합니다',\n        trigger: 'blur'\n      }],\n      content: [{\n        required: true,\n        message: '내용을 입력해주세요',\n        trigger: 'blur'\n      }]\n    };\n    const editorOptions = {\n      modules: {\n        toolbar: [['bold', 'italic', 'underline', 'strike'], ['blockquote', 'code-block'], [{\n          'header': 1\n        }, {\n          'header': 2\n        }], [{\n          'list': 'ordered'\n        }, {\n          'list': 'bullet'\n        }], [{\n          'script': 'sub'\n        }, {\n          'script': 'super'\n        }], [{\n          'indent': '-1'\n        }, {\n          'indent': '+1'\n        }], [{\n          'direction': 'rtl'\n        }], [{\n          'size': ['small', false, 'large', 'huge']\n        }], [{\n          'header': [1, 2, 3, 4, 5, 6, false]\n        }], [{\n          'color': []\n        }, {\n          'background': []\n        }], [{\n          'font': []\n        }], [{\n          'align': []\n        }], ['clean'], ['link', 'image']]\n      },\n      placeholder: '내용을 입력하세요...'\n    };\n    const user = computed(() => store.state.auth.user);\n    const canWrite = computed(() => {\n      return user.value && (user.value.isAdmin || user.value.hasNoticePermission);\n    });\n    const onEditorReady = quill => {\n      console.log('Editor is ready!', quill);\n    };\n    const handleFileChange = file => {\n      console.log('File changed:', file);\n    };\n    const handleFileRemove = file => {\n      console.log('File removed:', file);\n      const index = uploadedFiles.value.findIndex(f => f.originalFilename === file.name);\n      if (index > -1) {\n        uploadedFiles.value.splice(index, 1);\n      }\n    };\n    const uploadFiles = async () => {\n      const files = fileList.value.map(item => item.raw).filter(Boolean);\n      const uploaded = [];\n      for (const file of files) {\n        try {\n          const result = await store.dispatch('notice/uploadFile', file);\n          uploaded.push(result);\n        } catch (error) {\n          ElMessage.error(`파일 업로드 실패: ${file.name}`);\n          throw error;\n        }\n      }\n      return uploaded;\n    };\n    const submitNotice = async () => {\n      if (!canWrite.value) {\n        ElMessage.error('게시글 작성 권한이 없습니다.');\n        return;\n      }\n      try {\n        await noticeFormRef.value.validate();\n        loading.value = true;\n\n        // 파일 업로드\n        const attachments = await uploadFiles();\n        noticeForm.attachments = attachments;\n\n        // 공지사항 등록\n        await store.dispatch('notice/createNotice', noticeForm);\n        ElMessage.success('공지사항이 등록되었습니다.');\n        router.push('/notices');\n      } catch (error) {\n        console.error('공지사항 등록 실패:', error);\n        ElMessage.error('공지사항 등록에 실패했습니다.');\n      } finally {\n        loading.value = false;\n      }\n    };\n    const goBack = () => {\n      router.back();\n    };\n    onMounted(() => {\n      if (!canWrite.value) {\n        ElMessage.error('게시글 작성 권한이 없습니다.');\n        router.push('/notices');\n      }\n    });\n    return {\n      noticeFormRef,\n      uploadRef,\n      loading,\n      fileList,\n      noticeForm,\n      rules,\n      editorOptions,\n      canWrite,\n      onEditorReady,\n      handleFileChange,\n      handleFileRemove,\n      submitNotice,\n      goBack,\n      Upload\n    };\n  }\n};","map":{"version":3,"names":["ref","reactive","computed","onMounted","useStore","useRouter","ElMessage","Upload","QuillEditor","name","components","setup","store","router","noticeFormRef","uploadRef","loading","fileList","uploadedFiles","noticeForm","title","content","isNotice","attachments","rules","required","message","trigger","min","max","editorOptions","modules","toolbar","placeholder","user","state","auth","canWrite","value","isAdmin","hasNoticePermission","onEditorReady","quill","console","log","handleFileChange","file","handleFileRemove","index","findIndex","f","originalFilename","splice","uploadFiles","files","map","item","raw","filter","Boolean","uploaded","result","dispatch","push","error","submitNotice","validate","success","goBack","back"],"sources":["D:\\03.기타\\todolist\\frontend\\src\\views\\NoticeWrite.vue"],"sourcesContent":["<template>\r\n  <div class=\"notice-write\">\r\n    <div class=\"header\">\r\n      <h1>공지사항 작성</h1>\r\n    </div>\r\n\r\n    <div class=\"write-container\">\r\n      <el-form :model=\"noticeForm\" :rules=\"rules\" ref=\"noticeFormRef\" label-width=\"80px\">\r\n        <el-form-item label=\"제목\" prop=\"title\">\r\n          <el-input v-model=\"noticeForm.title\" placeholder=\"제목을 입력하세요\" />\r\n        </el-form-item>\r\n\r\n        <el-form-item label=\"공지사항\" prop=\"isNotice\">\r\n          <el-checkbox v-model=\"noticeForm.isNotice\">\r\n            공지사항으로 등록\r\n          </el-checkbox>\r\n        </el-form-item>\r\n\r\n        <el-form-item label=\"내용\" prop=\"content\">\r\n          <div class=\"editor-container\">\r\n            <QuillEditor\r\n              v-model:content=\"noticeForm.content\"\r\n              contentType=\"html\"\r\n              theme=\"snow\"\r\n              :options=\"editorOptions\"\r\n              @ready=\"onEditorReady\"\r\n            />\r\n          </div>\r\n        </el-form-item>\r\n\r\n        <el-form-item label=\"첨부파일\">\r\n          <div class=\"file-upload\">\r\n            <el-upload\r\n              ref=\"uploadRef\"\r\n              :auto-upload=\"false\"\r\n              :on-change=\"handleFileChange\"\r\n              :on-remove=\"handleFileRemove\"\r\n              :file-list=\"fileList\"\r\n              multiple\r\n              :limit=\"5\"\r\n            >\r\n              <el-button type=\"primary\" :icon=\"Upload\">\r\n                파일 선택\r\n              </el-button>\r\n              <template #tip>\r\n                <div class=\"el-upload__tip\">\r\n                  최대 5개 파일, 각 파일 10MB 이하\r\n                </div>\r\n              </template>\r\n            </el-upload>\r\n          </div>\r\n        </el-form-item>\r\n\r\n        <el-form-item>\r\n          <el-button type=\"primary\" @click=\"submitNotice\" :loading=\"loading\">\r\n            등록\r\n          </el-button>\r\n          <el-button @click=\"goBack\">취소</el-button>\r\n        </el-form-item>\r\n      </el-form>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport { ref, reactive, computed, onMounted } from 'vue'\r\nimport { useStore } from 'vuex'\r\nimport { useRouter } from 'vue-router'\r\nimport { ElMessage } from 'element-plus'\r\nimport { Upload } from '@element-plus/icons-vue'\r\nimport { QuillEditor } from '@vueup/vue-quill'\r\nimport '@vueup/vue-quill/dist/vue-quill.snow.css'\r\n\r\nexport default {\r\n  name: 'NoticeWrite',\r\n  components: {\r\n    QuillEditor\r\n  },\r\n  setup() {\r\n    const store = useStore()\r\n    const router = useRouter()\r\n    const noticeFormRef = ref()\r\n    const uploadRef = ref()\r\n    const loading = ref(false)\r\n    const fileList = ref([])\r\n    const uploadedFiles = ref([])\r\n\r\n    const noticeForm = reactive({\r\n      title: '',\r\n      content: '',\r\n      isNotice: false,\r\n      attachments: []\r\n    })\r\n\r\n    const rules = {\r\n      title: [\r\n        { required: true, message: '제목을 입력해주세요', trigger: 'blur' },\r\n        { min: 2, max: 200, message: '제목은 2-200자 사이여야 합니다', trigger: 'blur' }\r\n      ],\r\n      content: [\r\n        { required: true, message: '내용을 입력해주세요', trigger: 'blur' }\r\n      ]\r\n    }\r\n\r\n    const editorOptions = {\r\n      modules: {\r\n        toolbar: [\r\n          ['bold', 'italic', 'underline', 'strike'],\r\n          ['blockquote', 'code-block'],\r\n          [{ 'header': 1 }, { 'header': 2 }],\r\n          [{ 'list': 'ordered'}, { 'list': 'bullet' }],\r\n          [{ 'script': 'sub'}, { 'script': 'super' }],\r\n          [{ 'indent': '-1'}, { 'indent': '+1' }],\r\n          [{ 'direction': 'rtl' }],\r\n          [{ 'size': ['small', false, 'large', 'huge'] }],\r\n          [{ 'header': [1, 2, 3, 4, 5, 6, false] }],\r\n          [{ 'color': [] }, { 'background': [] }],\r\n          [{ 'font': [] }],\r\n          [{ 'align': [] }],\r\n          ['clean'],\r\n          ['link', 'image']\r\n        ]\r\n      },\r\n      placeholder: '내용을 입력하세요...'\r\n    }\r\n\r\n    const user = computed(() => store.state.auth.user)\r\n    const canWrite = computed(() => {\r\n      return user.value && (user.value.isAdmin || user.value.hasNoticePermission)\r\n    })\r\n\r\n    const onEditorReady = (quill) => {\r\n      console.log('Editor is ready!', quill)\r\n    }\r\n\r\n    const handleFileChange = (file) => {\r\n      console.log('File changed:', file)\r\n    }\r\n\r\n    const handleFileRemove = (file) => {\r\n      console.log('File removed:', file)\r\n      const index = uploadedFiles.value.findIndex(f => f.originalFilename === file.name)\r\n      if (index > -1) {\r\n        uploadedFiles.value.splice(index, 1)\r\n      }\r\n    }\r\n\r\n    const uploadFiles = async () => {\r\n      const files = fileList.value.map(item => item.raw).filter(Boolean)\r\n      const uploaded = []\r\n\r\n      for (const file of files) {\r\n        try {\r\n          const result = await store.dispatch('notice/uploadFile', file)\r\n          uploaded.push(result)\r\n        } catch (error) {\r\n          ElMessage.error(`파일 업로드 실패: ${file.name}`)\r\n          throw error\r\n        }\r\n      }\r\n\r\n      return uploaded\r\n    }\r\n\r\n    const submitNotice = async () => {\r\n      if (!canWrite.value) {\r\n        ElMessage.error('게시글 작성 권한이 없습니다.')\r\n        return\r\n      }\r\n\r\n      try {\r\n        await noticeFormRef.value.validate()\r\n        \r\n        loading.value = true\r\n\r\n        // 파일 업로드\r\n        const attachments = await uploadFiles()\r\n        noticeForm.attachments = attachments\r\n\r\n        // 공지사항 등록\r\n        await store.dispatch('notice/createNotice', noticeForm)\r\n        \r\n        ElMessage.success('공지사항이 등록되었습니다.')\r\n        router.push('/notices')\r\n      } catch (error) {\r\n        console.error('공지사항 등록 실패:', error)\r\n        ElMessage.error('공지사항 등록에 실패했습니다.')\r\n      } finally {\r\n        loading.value = false\r\n      }\r\n    }\r\n\r\n    const goBack = () => {\r\n      router.back()\r\n    }\r\n\r\n    onMounted(() => {\r\n      if (!canWrite.value) {\r\n        ElMessage.error('게시글 작성 권한이 없습니다.')\r\n        router.push('/notices')\r\n      }\r\n    })\r\n\r\n    return {\r\n      noticeFormRef,\r\n      uploadRef,\r\n      loading,\r\n      fileList,\r\n      noticeForm,\r\n      rules,\r\n      editorOptions,\r\n      canWrite,\r\n      onEditorReady,\r\n      handleFileChange,\r\n      handleFileRemove,\r\n      submitNotice,\r\n      goBack,\r\n      Upload\r\n    }\r\n  }\r\n}\r\n</script>\r\n\r\n<style scoped>\r\n.notice-write {\r\n  max-width: 800px;\r\n  margin: 0 auto;\r\n  padding: 20px;\r\n}\r\n\r\n.header {\r\n  margin-bottom: 30px;\r\n}\r\n\r\n.header h1 {\r\n  margin: 0;\r\n  font-size: 2rem;\r\n  font-weight: bold;\r\n}\r\n\r\n.write-container {\r\n  background: var(--el-bg-color);\r\n  border-radius: 8px;\r\n  padding: 30px;\r\n  box-shadow: 0 2px 12px 0 rgba(0, 0, 0, 0.1);\r\n}\r\n\r\n.editor-container {\r\n  border: 1px solid var(--el-border-color);\r\n  border-radius: 4px;\r\n}\r\n\r\n.editor-container :deep(.ql-editor) {\r\n  min-height: 300px;\r\n}\r\n\r\n.file-upload {\r\n  width: 100%;\r\n}\r\n\r\n.el-upload__tip {\r\n  color: var(--el-text-color-secondary);\r\n  font-size: 0.9rem;\r\n  margin-top: 8px;\r\n}\r\n\r\n@media (max-width: 768px) {\r\n  .notice-write {\r\n    padding: 15px;\r\n  }\r\n  \r\n  .write-container {\r\n    padding: 20px;\r\n  }\r\n  \r\n  .header h1 {\r\n    font-size: 1.5rem;\r\n  }\r\n}\r\n</style>\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}