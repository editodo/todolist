<!--?xml version="1.0" encoding="UTF-8" ?-->
 
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.ls.gpis.framework.buy_list">
     
      <!-- 법인별 구매집계 일별 데이터 -->
     <select id="selectBuyList_Day" resultType="hashmap" parameterType="hashmap" >
         SELECT CORPORATE_ID,
                CORPORATE_NAME,
                IN_DAY,
                FLOOR(SUM(IN_AMOUNT)) IN_AMOUNT,
                COUNT(CORPORATE_ID) BUY_COUNT	   
            FROM BUY_LIST
            WHERE CONVERT(DATETIME, IN_DAY) BETWEEN #{fromDate}  AND DATEADD(DAY, 0, #{toDate}  )
               AND CORPORATE_ID = #{CORPORATE_ID}
            GROUP BY CORPORATE_ID, CORPORATE_NAME, IN_DAY
            ORDER BY IN_DAY 
     </select>

     <!-- 법인별 구매집계 월별 데이터 -->
     <select id="selectBuyList_Month" resultType="hashmap" parameterType="hashmap" >
         
         SELECT CORPORATE_ID,
                CORPORATE_NAME,
                LEFT(REPLACE(IN_DAY, '-', ''), 6) IN_DAY,
                FLOOR(SUM(IN_AMOUNT)) IN_AMOUNT,
                COUNT(CORPORATE_ID) BUY_COUNT	   
            FROM BUY_LIST
            WHERE IN_DAY BETWEEN #{fromMonth} AND  DATEADD(MONTH, 1, '${toMonth}' + '-01')
              AND CORPORATE_ID = #{CORPORATE_ID}
            GROUP BY CORPORATE_ID, CORPORATE_NAME, LEFT(REPLACE(IN_DAY, '-', ''), 6)
             ORDER BY IN_DAY 
     </select>

    <!-- 법인별 구매집계 년간 합산 데이터 -->
    <select id="selectBuyList_Year" resultType="hashmap" parameterType="hashmap" >
        SELECT CORPORATE_ID,
                CORPORATE_NAME,
                LEFT(IN_DAY, 4) IN_DAY,
                FLOOR(SUM(IN_AMOUNT)) IN_AMOUNT,
                COUNT(CORPORATE_ID) BUY_COUNT	   
            FROM BUY_LIST            
            WHERE LEFT(IN_DAY, 4) BETWEEN #{fromYear} AND #{toYear}
              AND CORPORATE_ID = #{CORPORATE_ID}
            GROUP BY CORPORATE_ID, CORPORATE_NAME, LEFT(IN_DAY, 4)
             ORDER BY IN_DAY 
     </select>

     <!-- 국가별 구매이력 -->
     <select id="selectBuyList_Country" resultType="hashmap" parameterType="hashmap" >
         SELECT CORPORATE_ID,
                CORPORATE_NAME,
                ISNULL(IN_COUNTRY, '기타') IN_COUNTRY,
                FLOOR(SUM(IN_AMOUNT)) IN_AMOUNT,
                COUNT(CORPORATE_ID) BUY_COUNT	   
            FROM BUY_LIST
            WHERE 1 = 1            
              <if test="fromDate != NULL and fromDate != '' and toDate != NULL and toDate != ''"  >
                AND IN_DAY BETWEEN #{fromDate}  AND DATEADD(DAY, 0, #{toDate}  )
              </if>                            
              <if test="CORPORATE_ID != NULL and CORPORATE_ID != ''">
                AND CORPORATE_ID = #{CORPORATE_ID}
              </if>              
            GROUP BY CORPORATE_ID, CORPORATE_NAME, IN_COUNTRY
            
     </select>

      <!-- 분류별 구매 집계 -->
     <select id="selectBuyList_Class" resultType="hashmap" parameterType="hashmap" >
         SELECT CORPORATE_ID,
                CORPORATE_NAME,
                ISNULL(PRODUCT_CLASS, '기타') PRODUCT_CLASS,
                FLOOR(SUM(IN_AMOUNT)) IN_AMOUNT,
                COUNT(CORPORATE_ID) BUY_COUNT	   
            FROM BUY_LIST
            WHERE 1 = 1            
              <if test="fromDate != NULL and fromDate != '' and toDate != NULL and toDate != ''"  >
                AND IN_DAY BETWEEN #{fromDate}  AND DATEADD(DAY, 0, #{toDate}  )
              </if>                            
              <if test="CORPORATE_ID != NULL and CORPORATE_ID != ''">
                AND CORPORATE_ID = #{CORPORATE_ID}
              </if>              
              <if test="PRODUCT_CLASS != NULL and PRODUCT_CLASS != ''">
                AND PRODUCT_CLASS = #{PRODUCT_CLASS}
              </if>              
            GROUP BY CORPORATE_ID, CORPORATE_NAME, PRODUCT_CLASS
            
     </select>



</mapper>
