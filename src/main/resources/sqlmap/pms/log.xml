<!--?xml version="1.0" encoding="UTF-8" ?-->
 
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.ls.gpis.framework.log">
   
       <!-- 로그정보를 가져온다. -->
       <select id="selectLogInfo" resultType="hashMap">
              SELECT LOGIN_ID,
                     USER_IP,
                     REQ_URL,
                     CONVERT(VARCHAR(32),REQ_DT, 120) REQ_DT
                FROM CMT_USE_LOG
                WHERE CONVERT(VARCHAR(10),REQ_DT, 120) BETWEEN #{fromDate} AND #{toDate}
                <if test="loginID != null and loginID != ''">
                       AND LOGIN_ID LIKE '%' + #{loginID} +'%'
                </if>
                ORDER BY REQ_DT DESC
       </select>

       <!-- 오류 리스트를 가져온다. -->
       <select id="selectErrLogList" resultType="hashMap">
              SELECT ERROR_LOG_SEQ,
                     LOGIN_ID,
                     MENU_ID,
                     REQ_URL,
                     CONVERT(VARCHAR(32),REQ_DT, 120) REQ_DT,
                     CAUSE_CLASS_NM,
                     CAUSE_EXCEPTION_NM,
                     CAUSE_EXCEPTION_MSG	  
              FROM CMT_ERROR_LOG
              WHERE CONVERT(VARCHAR(10),REQ_DT, 120) BETWEEN #{fromDate} AND #{toDate}
              <if test="loginID != null and loginID != ''">
                       AND LOGIN_ID LIKE '%' + #{loginID} +'%'
              </if>
              ORDER BY ERROR_LOG_SEQ DESC
       </select>





	<!-- 에러로그를 DB에 저장한다. -->
	<insert id="insertErrorLog" parameterType="hashMap" >
              INSERT INTO CMT_ERROR_LOG(LOGIN_ID, MENU_ID, USER_IP, REQ_URL, REQ_DT, CAUSE_CLASS_NM, CAUSE_EXCEPTION_NM, CAUSE_EXCEPTION_MSG)
              VALUES(#{LOGIN_ID}, #{MENU_ID}, #{USER_IP}, #{REQ_URL}, GETDATE(), #{CAUSE_CLASS_NM}, #{CAUSE_EXCEPTION_NM}, #{CAUSE_EXCEPTION_MSG})

	</insert>

       <!-- 사용 로그를 DB에 저장한다. -->
	<insert id="insertUseLog" parameterType="hashMap" >
              INSERT INTO CMT_USE_LOG(LOGIN_ID, USER_IP, REQ_URL, REQ_DT)
              VALUES(#{LOGIN_ID}, #{USER_IP}, #{REQ_URL}, GETDATE())
	</insert>


          <!-- 사용자 로그인 로그를 DB에 저장한다. -->
	<insert id="insertUseLoginLog" parameterType="hashMap" >
              INSERT INTO CMT_USE_LOG_LOGIN(LOGIN_ID, USER_IP, REQ_DT)
              VALUES(#{LOGIN_ID}, #{USER_IP}, CONVERT(VARCHAR, GETDATE(), 120))
	</insert>

       <!--사용자 로그인정보를 가져온다. -->
       <select id="selectUseLoginLog" resultType="hashMap">
              SELECT LOGIN_ID,
                     CE.EMP_NAME,
                     CE.DEPT_NAME,
                     USER_IP,
                     REQ_DT
                FROM CMT_USE_LOG_LOGIN LOG
                LEFT JOIN CMT_EMP CE ON CE.EMP_USER_ID = LOG.LOGIN_ID 
               WHERE CONVERT(VARCHAR(10),REQ_DT, 120) BETWEEN #{fromDate} AND #{toDate}
            <if test="loginID != null and loginID != ''">
                 AND LOGIN_ID LIKE '%' + #{loginID} +'%'
            </if>
                ORDER BY REQ_DT DESC
       </select>

</mapper>

