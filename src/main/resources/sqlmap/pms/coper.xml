<!--?xml version="1.0" encoding="UTF-8" ?-->
 
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.ls.gpis.framework.coper">
    


    <!--법인 정보를 업데이트 한다.-->
  	<update id="updateCoper" parameterType="map">

	   MERGE INTO CORPORATE CE
        USING(SELECT #{CORPORATE_ID} CORPORATE_ID) SRC ON (CE.CORPORATE_ID = SRC.CORPORATE_ID)
	   WHEN MATCHED THEN
		  UPDATE 
             SET CORPORATE_NAME = #{CORPORATE_NAME},
                ACTV =  #{ACTV}                ,
                UPDATE_DATE = GETDATE(), 
                UPDATE_ID = #{UPDATER_ID}
	   WHEN NOT MATCHED THEN
	    INSERT (CORPORATE_ID, CORPORATE_NAME, CREATED_DATE, CREATER_ID, ACTV)
		VALUES(#{CORPORATE_ID}, #{CORPORATE_NAME}, GETDATE(),  #{CREATER_ID},  #{ACTV});
    
	</update>

 

    <!--전체 법인 리스트를 반환한다. -->
    <select id="selectCoperList" resultType="hashmap" parameterType="map">
        SELECT CORPORATE_NO
                ,CORPORATE_ID
                ,CORPORATE_NAME
                ,ACTV
                ,FORMAT(CREATED_DATE,'yyyy-MM-dd') CREATED_DATE
                ,(select isnull(emp_name,'') emp_name from cmt_emp where emp_user_id=a.CREATER_ID) CREATER_ID
                ,FORMAT(UPDATE_DATE,'yyyy-MM-dd') UPDATE_DATE
                ,(select isnull(emp_name,'') emp_name from cmt_emp where emp_user_id=a.UPDATE_ID) UPDATE_ID
            FROM CORPORATE a
        where 1=1
        <if test="CORPORATE_ID != NULL and CORPORATE_ID != ''">
            AND CORPORATE_ID = #{CORPORATE_ID}
        </if>
    </select>

    <select id="selectCoper" resultType="hashmap" parameterType="map">
        SELECT CORPORATE_NO
                ,CORPORATE_ID
                ,CORPORATE_NAME
                ,ACTV
                ,CREATED_DATE
                ,CREATER_ID
                ,UPDATE_DATE
                ,UPDATE_ID
            FROM CORPORATE
        where 1=1
        <if test="CORPORATE_ID != NULL and CORPORATE_ID != ''">
            AND CORPORATE_ID = #{CORPORATE_ID}
        </if>        
    </select>

</mapper>

