<!--?xml version="1.0" encoding="UTF-8" ?-->
 
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.ls.gpis.framework.board">


    <!-- 게시물 리스트를 반환한다. -->
    <select id="selectBoardList" resultType="hashmap" >
        SELECT CONTENTS_ID, 
                B_ID, 
                TITLE, 
                COUNT, 
                CREATER, 
                CONVERT(DATE, CREATED_DATE, 122) CREATED_DATE                
            FROM BOARD
            WHERE B_ID = #{B_ID}
              AND DEL_FLAG = 'N' 
              AND OWNER_ID IS NULL
            ORDER BY CONTENTS_ID DESC
    </select>

    <!-- 댓글 리스트를 반환한다. -->
    <select id="selectBoardCommentList" resultType="hashmap" >
        SELECT CONTENTS_ID, 
                B_ID, 
                CONTENTS, 
                COUNT, 
                CREATER, 
                CREATED_DATE                
            FROM BOARD
            WHERE B_ID = #{B_ID}
              AND DEL_FLAG = 'N' 
              AND OWNER_ID = #{OWNER_ID}
            ORDER BY CONTENTS_ID ASC
    </select>


    <!-- 게시물 등록 -->
    <insert id="insertBoardContents" parameterType="hashmap">
        <selectKey keyProperty="CONTENTS_ID" resultType="int" order="BEFORE">
            SELECT ISNULL(MAX(CONTENTS_ID), 0) + 1
              FROM BOARD
        </selectKey>

        INSERT INTO BOARD(CONTENTS_ID, B_ID, TITLE, CONTENTS, COUNT, DEL_FLAG, CREATER, CREATED_DATE)
        VALUES(
            #{CONTENTS_ID},
            #{B_ID},
            #{TITLE},
            #{CONTENTS},
            0,
            'N',
            #{CREATER},
            GETDATE()
         )
    </insert>

    <!-- 댓글 등록 -->
    <insert id="insertBoardComment" parameterType="hashmap">
        <selectKey keyProperty="CONTENTS_ID" resultType="int" order="BEFORE">
            SELECT ISNULL(MAX(CONTENTS_ID), 0) + 1
              FROM BOARD
        </selectKey>

        INSERT INTO BOARD(CONTENTS_ID, OWNER_ID, B_ID, CONTENTS, COUNT, DEL_FLAG, CREATER, CREATED_DATE)
        VALUES(
            #{CONTENTS_ID},
            #{OWNER_ID},
            #{B_ID},            
            #{CONTENTS},
            0,
            'N',
            #{CREATER},
            GETDATE()
         )
    </insert>





    
    
    <!-- 게시물 반환 -->
    <select id="selectBoardContents" parameterType="hashmap"  resultType="hashmap">
        SELECT CONTENTS_ID, 
            B_ID, 
            TITLE, 
            CONTENTS, 
            COUNT, 
            CREATER,
            CREATED_DATE,
            CONVERT(DATE, CREATED_DATE, 122) CREATED_DATE_STR
        FROM BOARD
        WHERE DEL_FLAG = 'N'        
        AND B_ID = #{B_ID}
        AND CONTENTS_ID = #{CONTENTS_ID}
    </select>

    <!-- 게시물 정보를 수정한다.-->
    <update id="updateBoardContents" parameterType="hashmap" >
        UPDATE BOARD
            SET TITLE = #{TITLE},
                CONTENTS = #{CONTENTS},
                COUNT = #{COUNT},
                UPDATER = #{UPDATER},
                UPDATED_DATE = GETDATE()                
        WHERE B_ID = #{B_ID}
        AND CONTENTS_ID = #{CONTENTS_ID}
    </update>

    <!-- 코멘트 정보를 수정한다.-->
    <update id="updateBoardComment" parameterType="hashmap" >
        UPDATE BOARD
            SET 
                CONTENTS = #{CONTENTS},                
                UPDATER = #{UPDATER},
                UPDATED_DATE = GETDATE()                
        WHERE B_ID = #{B_ID}
        AND CONTENTS_ID = #{CONTENTS_ID}
    </update>



    


    <!--게시물 카운트를 업-->
    <update id="updateBoardContentsCountUp" parameterType="hashmap" >
        UPDATE BOARD
            SET COUNT = COUNT + 1
        WHERE B_ID = #{B_ID}
        AND CONTENTS_ID = #{CONTENTS_ID}
    </update>


    <!--게시물을 삭제한다.-->
    <update id="deleteBoardContents" parameterType="hashmap" >
        UPDATE BOARD 
          SET DEL_FLAG = 'Y'
        WHERE  B_ID = #{B_ID}
          AND CONTENTS_ID = #{CONTENTS_ID}
    </update>


</mapper>
